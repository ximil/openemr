<?php
	$form = $this->form;
	$form->setAttribute('action', $this->url('lab', array('action' => 'savedata')));
	$form->prepare();
	
	echo $this->form()->openTag($form);
	echo $this->formRow($form->get('hiddensubmit'));
	echo $this->formRow($form->get('patient_id'));
	echo $this->formRow($form->get('encounter_id'));
	echo $this->formRow($form->get('procedurecount[0][]'));
        echo $this->headScript()->prependFile($this->basePath() . '/js/lab/labOrder.js');
        echo $this->headScript()->prependFile($this->basePath() . '/js/lab/procProviders.js');
        echo $this->headLink()->prependStylesheet($this->basePath() . '/css/labOrder.css');
?>
<?php if ($this->message == 'N') { ?>
    <div class="easyui-accordion" style="width:auto;height:550px;">
        <div  title="<?php echo xlt('Procedure Order'); ?>" style="overflow:auto;padding:10px;">
            <div id="dlg" class="easyui-dialog" title="<?php echo xlt('Message');?>" data-options="iconCls:'icon-save'" style="width:400px;height:200px;padding:10px">
                    <div style="margin: 50px; font-size: 14px;"><?php echo xlt('Please select a patient and encounter .. !');?></div>
            </div>
        </div>
    </div>
<?php } else { ?>
<!--a href="#"  plain="true" onclick="newOrder();">
    <img  class="easyui-linkbutton" iconCls="icon-multiple" src=<?php echo $this->basePath() .'/css/icons/multiple.png'; ?> title=<?php echo xlt('Order'); ?> border=0 />
    <?php echo xlt('New Order'); ?>
</a-->
<div style="margin-bottom: 2px;"></div>
<div style="background: linear-gradient(to bottom, #EFF5FF 0px, #E0ECFF 100%) repeat-x scroll 0 0 transparent; padding: 5px; border:1px solid #95B8E7;">
    <div >
        <a href="javascript:void(0)"  onclick="saveFrm();" class="easyui-linkbutton" iconCls="icon-save" title=<?php echo xlt('Save'); ?>>
    <?php echo xlt('Save'); ?>
        </a>
        <a href="javascript:void(0)" class="easyui-linkbutton"
            data-options="iconCls:'icon-providers'"
           onclick="$('#dlgProvider').dialog('open')"><?php echo xlt('Providers'); ?>
        </a>
    </div>
</div>
<div style="margin-bottom: 2px;"></div>
<div id='accord' class="easyui-accordion" style="width:1080px;height:550px;overflow:auto">
    <div id='main_1' title="<?php echo xlt('Procedur Order'); ?>" data-options="iconCls:'icon-single'" style="overflow:auto;padding:10px; width:auto;">
            <div id="toolbar_1">
                <span style="padding-left: 10px;" >
                    <a href="javascript:void(0)" id='addButton_1'  plain="true" onclick="addRow(this.id);">
                        <img  src=<?php echo $this->basePath() .'/css/icons/edit_add.png'; ?> title=<?php echo xlt('Add'); ?> border=0 />
                        <?php echo xlt('Add Procedure'); ?>
                    </a>
                </span>
                <span style="padding-left: 10px;" >
                    <a href="#"  plain="true" onclick="newOrder();">
                        <img  class="easyui-linkbutton" iconCls="icon-multiple" src=<?php echo $this->basePath() .'/css/icons/multiple.png'; ?> title=<?php echo xlt('Order'); ?> border=0 />
                        <?php echo xlt('New Order'); ?>
                    </a>
                </span>
            </div>
            <div id='editor_1' style="text-align: left; padding-left:20px;">
                <table id='tt_1' border='0' class="dv-table gridtable" style="width:98%;background:#fafafa;padding:1px;margin-top:5px;margin-bottom:15px;border:1px solid #95B8E7; box-shadow: 10px 10px 5px #E0E0EB;">
                    <tr style="font-weight: bold">
                        <td><?php echo xlt('Ordering Provider');?></td>
                        <td><?php echo xlt('Sending To');?></td>
                        <td><?php echo xlt('Order Date');?></td>
                        <td id="internaltimecaption_1_1" style="display:none"><?php echo xlt('Internal Time Collected');?></td>
                        <td><?php echo xlt('Internal Comments');?></td>
                        <td id='specimencollectedcaption_1_1' style="display:none"><?php echo xlt('Specimen Collected');?></td>
                        <td><?php echo xlt('Priority');?></td>
                        <td><?php echo xlt('Status');?></td>
                        <td id='billtocaption_1_1' style="display:none" valign='top'><?php echo xlt('Bill To');?></td>
                    </tr>
                    <tr>
                        <td valign='top'><?php echo $this->formRow($form->get('provider[0][]'));?></td>
                        <td valign='top'><?php echo $this->formRow($form->get('lab_id[0][]'));?></td>
                        <td valign='top'>
                            <?php echo $this->formRow($form->get('orderdate[0][]'));?>
                        </td>
                        <td valign='top' id="internaltime_1_1" style="display:none">
                                <?php //echo $this->formRow($form->get('timecollected[0][]'));?>
                        </td>
                        <td  valign='top'><?php echo $this->formRow($form->get('internal_comments[0][]'));?></td>
                        <td valign='top' id='specimencollectedtd_1_1' style="display:none">
                            <?php echo $this->formRadio($form->get('specimencollected[0][]'), 'prepend');?>
                        </td>
                        <td valign='top'><?php echo $this->formRow($form->get('priority[0][]'));?></td>
                        <td valign='top'><?php echo $this->formRow($form->get('status[0][]'));?></td>
                        <td id='billtotd_1_1' style="display:none" valign='top'><?php echo $this->formRow($form->get('billto[0][]'));?></td>
                    </tr>
                </table>

                <table id='dgord_1' border='0'  style="width:98%;background:#fafafa;padding:5px;margin-top:5px;margin-bottom:15px;border:1px solid #95B8E7; box-shadow: 10px 10px 5px #E0E0EB;">
                    <tr>
                        <td>
                            <table class="dv-table gridtable" style="width:100%;background:#fafafa;padding:5px;">
                            <tr  style="font-weight: bold">
                                    <td width='40%' valign='top'><?php echo xlt('Patient Instructions');?></td>
                                    <td width='20%' valign='top'><?php echo xlt('Diagnoses');?></td>
                                    <td width='20%' valign='top'><?php echo xlt('Procedure');?></td>
                                    <td align='center'><?php echo xlt('Action'); ?></td>
                            </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td id="insTempl_1_1">
                            <table id='cloneID_1_1' class="dv-table gridtable" style="width:100%;background:#fafafa;padding:5px;">
                            <tr >
                                    <td width='40%' valign='top'><?php echo $this->formRow($form->get('patient_instructions[0][]'));?></td>
                                    <td width='20%' valign='top'>
                                        <span id="diagnosestemplate_1_1">
                                            <?php echo $this->formRow($form->get('diagnoses[0][]'));?>
                                            <div class="autocomplete-suggestions" id="diagnodiv_1_1" style="display:none;z-index:99999;position:absolute;min-width:150px"></div>
                                        </span>
                                    </td>
                                    <td width='20%' valign='top'>
                                        <span id="proceduretemplate_1_1">
                                            <?php echo $this->formRow($form->get('procedures[0][]'));?>
                                            <div class="autocomplete-suggestions" id="prodiv_1_1" style="display:none;z-index:99999;position:absolute;min-width:150px"></div>
                                            <?php echo $this->formRow($form->get('procedure_code[0][]'));?>
                                             <?php echo $this->formRow($form->get('procedure_suffix[0][]'));?>
                                        </span>
                                    </td>
                                    <td valign='top' align='center'>
                                        <span style="padding-left: 10px;" >
                                            <a href="#" id='deleteButton_1_1'  style="height: 20px;"  plain="true" onclick="cancelItem(this.id)">
                                                <img  class="easyui-linkbutton" iconCls="icon-cancel" src=<?php echo $this->basePath() .'/css/icons/cancel.png'; ?> title=<?php echo xlt('Cancel'); ?> border=0 />
                                                <?php echo xlt('Cancel'); ?>
                                            </a>
                                        </span>
                                        <span style="padding-left: 10px;" >
                                            <a href="javascript:void(0)" id='addButton_1_1'  plain="true" onclick="addRow(this.id);">
                                                <img  src=<?php echo $this->basePath() .'/css/icons/edit_add.png'; ?> title=<?php echo xlt('Add'); ?> border=0 />
                                                <?php echo xlt('Add'); ?>
                                            </a>
                                        </span>
                                    </td> 
                            </tr>
                            <tr id="AOEtemplate_1_1"  style="display:none">
                                    <!--<td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>-->
                                    <td id="AOE_1_1" colspan='4'></td>
                            </tr>
                            </table>
                        </td>
                    </tr>
                </table><!-- End dgord-->
           </div><!-- End editor -->
    </div><!-- End main -->
  
</div><!-- End accord -->

<?php
        }
        echo $this->form()->closeTag();
	echo $this->headScript()//->prependFile($this->basePath() . '/js/lib/jquery-1.8.2.min.js')
				->prependFile($this->basePath() . '/js/lab/lab.js')
				->prependFile($this->basePath() . '/js/lib/jquery.autocomplete.js')
				->prependFile($this->basePath() . '/js/lib/jQuery.bubbletip-1.0.6.js')
				->prependFile($this->basePath() . '/js/lib/bubbles.js')
?>
<!-- Start Row Template -->
<div style="display:none" id="procedureclonetemplate">
<table  id='cloneID_1' class="dv-table gridtable" style="width:100%;background:#fafafa;padding:5px;">
<tr>
        <td width='40%' valign='top'><?php echo $this->formRow($form->get('patient_instructions[0][]'));?></td>
        <td width='20%' valign='top'>
            <span id="diagnosestemplate">
                <?php echo $this->formRow($form->get('diagnoses[0][]'));?>
                <div class="autocomplete-suggestions" id="diagnodiv" style="display:none;z-index:99999;position:absolute;min-width:150px"></div>
            </span>
        </td>
        <td width='20%' valign='top'>
            <span id="proceduretemplate">
                <?php echo $this->formRow($form->get('procedures[0][]'));?>
                <div class="autocomplete-suggestions" id="prodiv" style="display:none;z-index:99999;position:absolute;min-width:150px"></div>
                <?php echo $this->formRow($form->get('procedure_code[0][]'));?>
                 <?php echo $this->formRow($form->get('procedure_suffix[0][]'));?>
            </span>
        </td>
        <td valign='top' align='center'>
            <span style="padding-left: 10px;" >
                <a href="#" id='deleteButton'  style="height: 20px;"  plain="true" onclick="cancelItem(this.id)">
                    <img  class="easyui-linkbutton" iconCls="icon-cancel" src=<?php echo $this->basePath() .'/css/icons/cancel.png'; ?> title=<?php echo xlt('Cancel'); ?> border=0 />
                    <?php echo xlt('Cancel'); ?>
                </a>
            </span>
            <span style="padding-left: 10px;" >
                <a href="javascript:void(0)" id='addButton'  plain="true" onclick="addRow(this.id);">
                    <img  src=<?php echo $this->basePath() .'/css/icons/edit_add.png'; ?> title=<?php echo xlt('Add'); ?> border=0 />
                    <?php echo xlt('Add'); ?>
                </a>
            </span>
        </td> 
</tr>
<tr id="AOEtemplate"  style="display:none">
        <!--<td>&nbsp;</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>-->
        <td id="AOE" colspan='4'></td>
</tr>
</table>
</div>
<!-- End Row Template -->

<!-- Start New Order Template -->
<div style="display:none" id="newprocedureclonetemplate">
<div id='mainTemplate'>
    <div id='main' title="<?php echo xlt('Procedur Order'); ?>" data-options="iconCls:'icon-single'" style="overflow:auto;padding:10px;">
            <div id="toolbar">
                <span style="padding-left: 10px;" >
                    <a href="javascript:void(0)" id='addButton'  plain="true" onclick="addRow(this.id);">
                        <img  src=<?php echo $this->basePath() .'/css/icons/edit_add.png'; ?> title=<?php echo xlt('Add'); ?> border=0 />
                        <?php echo xlt('Add Procedure'); ?>
                    </a>
                </span>
                <span style="padding-left: 10px;" >
                    <a href="#"  plain="true" onclick="newOrder();">
                        <img  class="easyui-linkbutton" iconCls="icon-multiple" src=<?php echo $this->basePath() .'/css/icons/multiple.png'; ?> title=<?php echo xlt('Order'); ?> border=0 />
                        <?php echo xlt('New Order'); ?>
                    </a>
                </span>
                <span style="margin-left: 70%;">
                    <a href="javascript:void(0)"  onclick="removeAccord()">
                        <img  class="easyui-linkbutton" iconCls="icon-no" src=<?php echo $this->basePath() .'/css/icons/no.png'; ?> title=<?php echo xlt('Remove Order'); ?> border=0 />
                        <?php echo xlt('Remove Order'); ?>
                    </a>
                </span>
            </div>
            <div id='editor' style="text-align: left; padding-left:20px;">

                <table id='tt' border='0' class="dv-table gridtable" style="width:98%;background:#fafafa;padding:1px;margin-top:5px;margin-bottom:15px;border:1px solid #95B8E7; box-shadow: 10px 10px 5px #E0E0EB;">
                    <tr style="font-weight: bold">
                        <td><?php echo xlt('Ordering Provider');?></td>
                        <td><?php echo xlt('Sending To');?></td>
                        <td><?php echo xlt('Order Date');?></td>
                        <td id='internaltimecaption' style="display:none" style="display:none"><?php echo xlt('Internal Time Collected');?></td>
                        <td><?php echo xlt('Internal Comments');?></td>
                        <td id='specimencollectedcaption' style="display:none" ><?php echo xlt('Specimen Collected');?></td>
                        <td><?php echo xlt('Priority');?></td>
                        <td><?php echo xlt('Status');?></td>
                        <td id='billtocaption' style="display:none" valign='top'><?php echo xlt('Bill To');?></td>
                    </tr>
                    <tr>
                        <td valign='top'><?php echo $this->formRow($form->get('provider[0][]'));?></td>
                        <td valign='top'><?php echo $this->formRow($form->get('lab_id[0][]'));?></td>
                        <td valign='top' id="oderingdate"><?php echo $this->formRow($form->get('orderdate[0][]'));?></td>
                        <td valign='top' id="internaltime" style="display:none"><?php echo $this->formRow($form->get('timecollected[0][]'));?></td>
                        <td  valign='top'><?php echo $this->formRow($form->get('internal_comments[0][]'));?></td>
                        <td id='specimencollectedtd' style="display:none" valign='top'><?php echo $this->formRadio($form->get('specimencollected[0][]'), 'prepend');?></td>
                        <td valign='top'><?php echo $this->formRow($form->get('priority[0][]'));?></td>
                        <td valign='top'><?php echo $this->formRow($form->get('status[0][]'));?></td>
                        <td id='billtotd' style="display:none" valign='top'><?php echo $this->formRow($form->get('billto[0][]'));?></td>
                    </tr>
                </table>

                <table id='dgord' border='0'  style="width:98%;background:#fafafa;padding:5px;margin-top:5px;margin-bottom:15px;border:1px solid #95B8E7; box-shadow: 10px 10px 5px #E0E0EB;">
                    <tr>
                        <td>
                            <table class="dv-table gridtable" style="width:100%;background:#fafafa;padding:5px;">
                            <tr  style="font-weight: bold">
                                    <td width='40%' valign='top'><?php echo xlt('Patient Instructions');?></td>
                                    <td width='20%' valign='top'><?php echo xlt('Diagnoses');?></td>
                                    <td width='20%' valign='top'><?php echo xlt('Procedure');?></td>
                                    <td align='center'><?php echo xlt('Action'); ?></td>
                            </tr>
                            </table>
                        </td>
                    </tr>
                    <!-- -->
                    <tr>
                        <td id="insTempl">
                        
                        </td>
                    </tr>
                    <!-- -->
                </table><!-- End dgord-->
           </div><!-- End editor -->
    </div><!-- End main -->
</div>
</div>
<!-- End New Order Template -->

<!-- Provider (Add or Edit) -->
<div id="dlgProvider" class="easyui-dialog" style="width:750px;height:415px;padding:10px 20px"  
            closed="true" buttons="#dlg-buttons">  
    <div class="ftitle" id='titleShow' style="color:#0068A4"><?php echo xlt('Providers List'); ?></div> 
    <table id="dgProvider" title="My Users" class="easyui-datagrid" style="width:800px;height:300px"  
            url="./getProcedureProviders"
            idField="ppid" 
            toolbar="#toolbarProvider"  
            rownumbers="true" fitColumns="true" singleSelect="true">  
        <thead>  
            <tr>  
                <th field="name" width="50"><?php echo xlt('Name'); ?></th>	
                <th field="npi" width="50"><?php echo xlt('NPI'); ?></th>  
                <th field="protocol" width="50"><?php echo xlt('Protocol'); ?></th>  
                <th field="labtype" width="50"><?php echo xlt('Type'); ?></th>  
            </tr>  
        </thead>  
    </table>  
    <div id="toolbarProvider">  
        <span>
        <a href="javascript:void(0)" class="easyui-linkbutton"
           iconCls="icon-add" plain="true" onclick="newProvider()">
            <?php echo xlt('New'); ?>
        </a>
        </span>
        <span id='editPProvider' style="display:none; float:left;">
        <a href="javascript:void(0)" class="easyui-linkbutton"
           iconCls="icon-edit" plain="true" onclick="editProvider()">
            <?php echo xlt('Edit'); ?>
        </a>
        </span>
        <span id='destroyPProvider' style="display:none; float:left;">
            <a href="javascript:void(0)" class="easyui-linkbutton"
               iconCls="icon-remove" plain="true" onclick="destroyProvider()">
                <?php echo xlt('Remove'); ?>
            </a>
        </span>
    </div>  
      
    <div id="dlg" class="easyui-dialog" style="width:700px;height:480px;padding:10px 20px"  
            closed="true" buttons="#dlg-buttons-providers">  
        <div class="ftitle"><?php echo xlt('Procedure Providers'); ?></div>  
        <form id="fmProcedureProvider" method="post" novalidate>  
            <input type="hidden" id="ppid" name="ppid" value="" />
            <table border='0'>
                <tr>
                    <td class="fitem"><?php echo xlt('Name'); ?>:</td>  
                    <td class="fitem"><input name="name" class="easyui-validatebox combo validatebox-text" style="width:100%" required="true"></td>
                </tr>
                <tr class="fitem">
                    <td><?php echo xlt('NPI'); ?>:</td>  
                    <td><input type='text' name="npi" value='' class="easyui-validatebox combo validatebox-text" style="width:100%" /></td>
                </tr>
                <tr class="fitem">
                    <td><?php echo xlt('Sender IDs'); ?>:</td>  
                    <td><?php echo xlt('Application'); ?>:
                    <input type='text' name="send_app_id" value='' class="easyui-validatebox combo validatebox-text"  />
                    <?php echo xlt('Facility'); ?>:
                    <input type='text' name="send_fac_id" value='' class="easyui-validatebox combo validatebox-text" /></td>
                </tr>
                <tr class="fitem">
                    <td><?php echo xlt('Receiver IDs'); ?>:</td>  
                    <td><?php echo xlt('Application'); ?>:
                    <input type='text' name="recv_app_id" value='' class="easyui-validatebox combo validatebox-text" />
                    <?php echo xlt('Facility'); ?>:
                    <input type='text' name="recv_fac_id" value='' class="easyui-validatebox combo validatebox-text" /></td>
                </tr>
                <tr>
                    <td class="fitem"><?php echo xlt('Usage'); ?>:</td>  
                    <td class="fitem">
                        <?php $usage = array(
                                            'D' => xl('Debugging'),
                                            'P' => xl('Production'),
                                             );
                        ?>
                        <input id="DorP" name="DorP" editable="false" class="easyui-combobox" data-options="
                                valueField: 'value',
                                textField: 'label',
                                data: [
                                <?php foreach($usage as $key => $value) {?>
                                    {label: '<?php echo $value; ?>',value: '<?php echo $key; ?>'},
                                 <?php } ?>
                                ]" />
                        
                    </td>
                </tr>
                <tr>
                    <td class="fitem"><?php echo xlt('Protocol'); ?>:</td>  
                    <td class="fitem">
                        <?php $usage = array(
                                            'DL' => xl('Download'),
                                            'SFTP' => xl('SFTP')
                                             );
                        ?>
                        <input id="protocol" name="protocol" editable="false" class="easyui-combobox" data-options="
                                valueField: 'value',
                                textField: 'label',
                                data: [
                                <?php foreach($usage as $key => $value) {?>
                                    {label: '<?php echo $value; ?>',value: '<?php echo $key; ?>'},
                                 <?php } ?>
                                ]" />
                        
                    </td>
                </tr>
                <tr>
                    <td class="fitem"><?php echo xlt('Remote Host'); ?>:</td>  
                    <td class="fitem"><input type='text' name="remote_host" vlaue=''
                                             class="easyui-validatebox combo validatebox-text" style="width:100%" /></td>
                </tr>
                <tr>
                    <td class="fitem"><?php echo xlt('Login'); ?>:</td>  
                    <td class="fitem"><input type='text' name="login" vlaue=''
                                             class="easyui-validatebox combo validatebox-text" style="width:100%" /></td>
                </tr>
                <tr>
                    <td class="fitem"><?php echo xlt('Password'); ?>:</td>  
                    <td class="fitem"><input type='text' name="password" vlaue=''
                                             class="easyui-validatebox combo validatebox-text" style="width:100%" /></td>
                </tr>
                <tr>
                    <td class="fitem"><?php echo xlt('Orders Path'); ?>:</td>  
                    <td class="fitem"><input type='text' name="orders_path" vlaue=''
                                             class="easyui-validatebox combo validatebox-text" style="width:100%" /></td>
                </tr>
                <tr>
                    <td class="fitem"><?php echo xlt('Results Path'); ?>:</td>  
                    <td class="fitem"><input type='text' name="results_path" vlaue=''
                                             class="easyui-validatebox combo validatebox-text" style="width:100%" /></td>
                </tr>
                <tr>
                    <td class="fitem"><?php echo xlt('Notes'); ?>:</td>  
                    <td class="fitem"><textarea name="notes" rows='3' cols='20'
                                                class="easyui-validatebox combo validatebox-text"
                                                style="height:20px; width:100%" ></textarea></td>
                </tr>
            </table>
            
        </form>  
    </div>  
    <div id="dlg-buttons-providers">  
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" onclick="saveProviders()">Save</a>  
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">Cancel</a>  
    </div>  
 
    <style type="text/css">  
        #fm{  
            margin:0;  
            padding:10px 30px;  
        }  
        .ftitle{  
            font-size:14px;  
            font-weight:bold;  
            padding:5px 0;  
            margin-bottom:10px;  
            border-bottom:1px solid #ccc;  
        }  
        .fitem{  
            margin-bottom:5px;  
        }  
        .fitem label{  
            display:inline-block;  
            width:80px;  
        }  
    </style>
</div>
