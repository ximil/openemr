<script type="text/javascript">
$(document).ready(function() {
  $(".show-more a").on("click", function() {
    var $link = $(this);
    var $content = $link.parent().prev("div.text-content");
    var linkText = $link.text();
    switchClasses($content);
    $link.text(getShowLinkText(linkText));
    return false;
  });
  $(function()  
  {  
    // One instance that's reused to show info for the current person  
    var container = $('<div id="personPopupContainer">'  
        + '  <div id="personPopupContent"></div>'  
        + '</div>');    
    $('body').append(container);    
    $('.personPopupTrigger').live('focus', function()  
    {  
        // format of 'rel' tag: pageid,personguid  
        var reason = $(this).attr('rel');  
        var pos = $(this).offset();  
        var width = $(this).width();
              //alert(pos.left+"-"+pos);
        container.css({  
      left: (pos.left - width + 40) + 'px',  
      top: pos.top - 5 + 'px'  
        });  
        $('#personPopupContent').html(reason);    
        container.css('display', 'block');    
        $('.personPopupTrigger').live('blur', function()  
        {  
         container.css('display', 'none');  
        });  
    });  
  });
});

$(function(){  
  $.contextMenu({
    selector: '.context-menu-res',
    build: function($trigger) {
      var options = {
        callback: function(key, options) {
          if(key == 'cancel'){
            var answer = prompt ("Please Enter Comment","");
            var details = this.attr('id').split("-");
            $.post("result/cancel",{
              order: details[1],
              seq: details[2],
              proc_name: details[3],
							comment: answer,
            },
            function(data){
              if(data.response == true){
                alert("Test cancelled");
              }else{
                alert("Failed");
              }
              document.location.reload();
            }, 'json');
          }
        },
        items: {}
      };
      options.items.cancel = {name: "Cancel Order"};
      return options;
    }
  });
});

function switchClasses($content){
    if($content.hasClass("short-text")){
        $content.removeClass("short-text");
        $content.addClass("full-text");
    } else {
        $content.removeClass("full-text");
        $content.addClass("short-text");
    }
}

function getShowLinkText(currentText){
    var newText = '';
    if (currentText.toUpperCase() === "SHOW MORE") {
        newText = "Show less";
    } else {
        newText = "Show more";
    }
    return newText;
}

function show_hide_comments(){
  if($("#showhide").hasClass('hide_comm')){
    $("#showhide").removeClass('hide_comm');
    $("#showhide").addClass('show_comm');
    $('tr[id^=full_comments_]').hide();
  }else if($("#showhide").hasClass('show_comm')){
    $("#showhide").removeClass('show_comm');
    $("#showhide").addClass('hide_comm');
    $('tr[id^=full_comments_]').show();
  }
}

</script>
         <?php
	 if ($this->message == 'N') { ?>
	    <div class="easyui-accordion" style="width:auto;height:550px;">
		<div  title="<?php echo xlt('Results'); ?>" style="overflow:auto;padding:10px;">
		    <div id="dlg" class="easyui-dialog" title="<?php echo xlt('Message');?>" data-options="iconCls:'icon-save'" style="width:400px;height:200px;padding:10px">
			    <div style="margin: 50px; font-size: 14px;"><?php echo xlt('Please select a patient!');?></div>
		    </div>
		</div>
	    </div>
	<?php }
	else{
	 $match = array(
              "/&lt;ref(?:[^\/&]|&(?!gt;))*\/&gt;/is","/&lt;ref[^\/]*&gt;(.*?)&lt;\/ref&gt;/s",);?> 
	     <div class="panel-header" style="width: 98.9%;">
             <div class="panel-title">Lab Result</div>
             <div class="panel-tool"></div>
         </div>
	     <div class="datagrid-wrap panel-body" title="" style="width: 99.8%;">
	      <div id="toolbar">
		   <!-- <a href="#" class="easyui-linkbutton" iconCls="icon-save" plain="true" onclick="javascript:$('#dg').edatagrid('saveRow')"><?php echo xlt('Save'); ?></a>
		    <a href="#" class="easyui-linkbutton" iconCls="icon-undo" plain="true" onclick="javascript:$('#dg').edatagrid('cancelRow')"><?php echo xlt('Cancel'); ?></a>
                   <!-- <span style="text-align: right; padding-left: 750px;">
                    <span class="extlab">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <span style="font-size: 10px;">  Ext Labs</span>
                    <span class="local">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <span style="font-size: 10px;"> <?php echo xlt('Local Labs'); ?></span>
                   </span>-->
		    <form id="frmsearch" method="post" novalidate>		   
		     <div style="text-align: left; padding-left:20px;">
                      
			 <fieldset style="width:25%;float:left;" >
				<legend><?php echo xlt('Date'); ?></legend>
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('From'); ?>: <input class="easyui-datebox" style="width:80px" name='dtFrom' >
			 </span>
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('To'); ?>: <input class="easyui-datebox" style="width:80px" name='dtTo' >
			 </span>
			 <br/>
			 <br/>
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('Encounter'); ?>:
			 <input id="searchenc" class="easyui-combobox" name="searchenc" 
                                data-options="valueField:'value',textField:'label',
                                url:'./result/listEncounters'" />
			 </span>
			 </fieldset>
			 <fieldset style="width:66%;float:right;height:30px;" >
				<legend><?php echo xlt('Status'); ?></legend>
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('Order'); ?>:
			 <input id="searchStatusOrder" class="easyui-combobox" name="searchStatusOrder" 
                                data-options="valueField:'value',textField:'label',
                                url:'./result/getLabOptions?opt=search&optId=order'" />
			 </span>
			 <span style="text-align: left; margin-right: 10px;margin-right:50px;">
			 <?php echo xlt('Report'); ?>:
			 <input id="cc" class="easyui-combobox" name="searchStatusReport" 
                                data-options="valueField:'value',textField:'label',
                                url:'./result/getLabOptions?opt=search&optId=report'" />
			 </span>
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('Result'); ?>:
			 <input id="searchStatusResult" class="easyui-combobox" name="searchStatusResult" 
                                data-options="valueField:'value',textField:'label',
                                url:'./result/getLabOptions?opt=search&optId=result'" />
			 </span>
			 </fieldset>
			 <fieldset style="width:66%;float:right;height:23px;" >
				<legend><?php echo xlt('Other'); ?></legend>
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('Test Name'); ?>:
			 <input id="searchtest" class="combo" name="searchtest" autocomplete="off" />
			 </span>
			 </fieldset>
			 <a href="#" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="doSearch()">
			 <!-- <input type="submit" value="Search" ></a>-->
                           <?php echo xlt('Search'); ?> </a>
			 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
       <a href="#" class="easyui-linkbutton hide_comm" id="showhide" onclick="show_hide_comments()"><?php echo xlt('Show/Hide Comments'); ?></a>
                         <span style="text-align: left; padding-right: 10px;float:right;margin-top:15px;">
                        <table cellpadding="0" cellspacing="0" border="0">
                            <tr>
                                <td class="icon-ok tdfont">&nbsp;&nbsp;&nbsp;&nbsp;</td><td>&nbsp;-&nbsp;</td><td class="tdfont "><?php echo xlt('Normal');?></td><td>&nbsp;&nbsp;</td>
                                <td class="icon-LL tdfont">&nbsp;&nbsp;&nbsp;&nbsp;</td><td>&nbsp;-&nbsp;</td><td class="tdfont "><?php echo xlt('Very Low');?></td><td>&nbsp;&nbsp;</td>
            
                                <td class="icon-A tdfont ">&nbsp;&nbsp;&nbsp;&nbsp;</td><td>&nbsp;-&nbsp;</td><td class="tdfont "><?php echo xlt('Abnormal');?></td><td>&nbsp;&nbsp;</td>
                                <td class="icon-HH tdfont">&nbsp;&nbsp;&nbsp;&nbsp;</td><td>&nbsp;-&nbsp;</td><td class="tdfont "><?php echo xlt('Very High');?></td><td>&nbsp;&nbsp;</td>
                            
                                <td class="icon-L tdfont ">&nbsp;&nbsp;&nbsp;&nbsp;</td><td>&nbsp;-&nbsp;</td><td class="tdfont "><?php echo xlt('Low');?></td><td>&nbsp;&nbsp;</td>
                                <td class="icon-H tdfont ">&nbsp;&nbsp;&nbsp;&nbsp;</td><td>&nbsp;-&nbsp;</td><td class="tdfont "><?php echo xlt('High');?></td>
                            </tr>
                        </table>
                         </span>
		  </div>
		  </form>
	     </div>
	     
	<!-- Lab Result listing starts here------------------------------------->
	<table id="labresult"  class="dv-table gridview2 thcolor" cellspacing="0" cellpadding="0" style="width:99%;height:auto;background:#ffffff;padding:5px;margin-top:5px;margin-bottom:15px;">
	       <thead">
                 <tr>
	          <th  colspan="4"><?php echo xlt('Order'); ?></th>     
                  <th  colspan="2"><?php echo xlt('Report'); ?></th>
                  <th  colspan="7"><?php echo xlt('Results and Recommendations'); ?></th>
		   <?php $count=0;$cnt=0;?>
		   <?php $i = 0; foreach ($labresults as $labresult) :
		   
		        if(($labresult['editor']==1) AND ($labresult['editor']!=0) AND $count==0){$check=1; ?> 
                          <th colspan="3"><?php echo xlt('Action'); ?></th>  
		           <?php $count=1; 
		           }
			elseif(($labresult['editor']==0) AND ($labresult['editor']!=1) )  { ?>
			      <th style="display:none;" colspan="3"><?php echo xlt('Action'); ?></th>
		          <?php }
			elseif((($labresult['editor']==0) OR ($labresult['editor']==1)) AND $cnt==0 AND $check!=1)  { ?>
			  <th colspan="3"><?php echo xlt('Action'); ?></th>  
		           <?php $cnt=1; }
		    $i++; endforeach; ?>
		         
                 </tr>
                </thead>
	         <tr>
			<td  class="headtd" width='4%'><b><?php echo xlt('PID'); ?></b></td>
			<td  class="headtd" width='5%'><b><?php echo xlt('Order Date'); ?></b></td>
			<!--<td  class="headtd" ><b><?php echo xlt('Procedure Name'); ?></b></td>-->
			<td  class="headtd" width='3%'><b><?php echo xlt('Ord.No.'); ?></b></td>
			<td  class="headtd" ><b><?php echo xlt('Status'); ?></b></td>
			<td  class="headtd" title="<?php echo xlt('Time Collected'); ?>"><b><?php echo xlt('Time Collected'); ?></b></td>
			<td  class="headtd" width='10%'><b><?php echo xlt('Status'); ?></b></td>
			<td  class="headtd" ><b><?php echo xlt('Name'); ?></b></td>
			<td  class="headtd"  width='3%'><b><?php echo xlt('Abn'); ?></b></td>
			<td  class="headtd"  width='4%'><b><?php echo xlt('Value'); ?></b></td>
			<td  class="headtd"  width='5%'><b><?php echo xlt('Units'); ?></b></td>
			<td  class="headtd"  width='6%'><b><?php echo xlt('Range'); ?></b></td>
                        <td  class="headtd"  width='4%'><b><?php echo xlt('Status'); ?></b></td>
			<td  class="headtd"  title="<?php echo xlt('Comments'); ?>"><b><?php echo xlt('Comm.'); ?></b></td>
			<?php $count=0;$cnt=0;?>
			<?php $i = 0; foreach ($labresults as $labresult) : 
			if(($labresult['editor']==1) AND ($labresult['editor']!=0) AND $count==0){$check=1; ?>
			<td class="headtd" title="<?php echo xlt('Label'); ?>"><b><?php echo xlt('Lbl.'); ?></b></td>
			<td class="headtd" title="<?php echo xlt('Requisition'); ?>"><b><?php echo xlt('Req.'); ?></b></td>
			<td class="headtd" title="<?php echo xlt('Result'); ?>"><b><?php echo xlt('Res.'); ?></b></td>
			 <?php $count=1; ?>
			
			<?php } elseif(($labresult['editor']==0) AND ($labresult['editor']!=1)) {?>
			<td style="display:none;" class="headtd" title="<?php echo xlt('Label'); ?>"><b><?php echo xlt('Lbl.'); ?></b></td>
			<td style="display:none;" class="headtd" title="<?php echo xlt('Requisition'); ?>"><b><?php echo xlt('Req.'); ?></b></td>
			<td style="display:none;" class="headtd" title="<?php echo xlt('Result'); ?>"> <?php echo xlt('Res.'); ?></b></td>
			<?php } elseif((($labresult['editor']==0) OR ($labresult['editor']==1)) AND $cnt==0 AND $check!=1)  { ?>
			<td class="headtd" ><b><?php echo xlt('Lbl.'); ?></b></td>
		        <td class="headtd" title="<?php echo xlt('Requisition'); ?>"><b><?php echo xlt('Req.'); ?></b></td>
		        <td class="headtd" title="<?php echo xlt('Result'); ?>"><b><?php echo xlt('Res.'); ?></b></td>
		        <?php  $cnt=1; }
			$i++; endforeach; ?>
			<td  style="display:none;" class="headtd" width='5%'><b><?php echo xlt('order'); ?></b></td>
	     
	        </tr>
	        <?php $i = 0;
                $main_grp = '';
								$code_suffix = '';
                $profile_grp = '';
                foreach ($labresults as $labresult) : 
                    $color = ($labresult['color'] <> "") ? $labresult['color'] : $color;
                    $totrows = $labresult['totalRows'];
                    if($labresult[order_title]=="" && $labresult[procedure_name] == "") continue;
                    $patient_instructions = $labresult[patient_instructions];
                    if($labresult[order_title] != '' && ($main_grp != $labresult[order_title] || $code_suffix != $labresult[code_suffix] || $labresult[order_id])){
			?>
                <tr style="background-color:<?php echo $color; ?>">
                                <td  class="tdfont childtdF" ><?php echo $this->escapeHtml($labresult[patient_id]);?>
                                <?php
                                if($labresult[patient_id] && $patient_instructions){?>
                                <a href="javascript:void(0)" class="personPopupTrigger" rel="<?php echo str_replace("\n","",$patient_instructions);?>"><img src=<?php echo $this->basePath() ?>/css/icons/comments.png title=<?php echo xlt('Internal Comments'); ?> >
                                <?php
                                }
                                ?>
                                </td>	
                         <td  class="tdfont childtd"><?php echo $this->escapeHtml($labresult[date_ordered]);?></td>
                         <td  class="tdfont childtd"><?php echo $this->escapeHtml($labresult[order_id]);?></td>
                         <td  class="tdfont childtd" nowrap=nowrap><?php echo $this->escapeHtml($labresult[order_status]);?></td>
                         <td  class="tdfont childtd" title="<?php echo $this->escapeHtml($labresult[date_collected]);?>" nowrap=nowrap>
                            <?php echo $this->escapeHtml($labresult[date_collected]);?>
                         </td>
		         <td class="tdfont childtd" ><?php echo $this->escapeHtml($labresult[report_status]);?></td>
                                <td  class="tdfont headchildtd" colspan="10" title="<?php echo $this->escapeHtml($labresult[order_title]);?>" nowrap=nowrap><b><?php echo $this->escapeHtml($labresult[order_title]);?></b></td>
                                <!--<td  class="tdfont childtd">&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" align="center">&nbsp;</td>-->
                                <?php  if(($labresult['editor']==1) AND ($labresult['editor']!=0)){ $check=1; ?>
                                <!--<td  class="tdfont childtd" > &nbsp; </td>
                                <td  class="tdfont childtd" > &nbsp;</td>
                                <td  class="tdfont childtd" > &nbsp;</td>-->
                                 
                                
                                <?php }elseif(($labresult['editor']==0) AND ($labresult['editor']!=1)){ ?>
                                <!--<td class="tdfont childtd" style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"> &nbsp;</td>
                                <td class="tdfont childtd" style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"> &nbsp;</td>
                                <td class="tdfont childtd" style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"> &nbsp;</td>
                                -->
                                <?php } elseif((($labresult['editor']==0) OR ($labresult['editor']==1))  AND $check!=1)  { ?>
                                
                                <!--<td  class="tdfont childtd" > &nbsp;</td>
                                <td  class="tdfont childtd" > &nbsp;</td>
                                <td  class="tdfont childtd" > &nbsp;</td>-->
                                 
                                
                                <?php } ?>
                                <td style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"   width='10%'>  <?php echo $this->escapeHtml($labresult[order_id]);?> </td>
                        </tr>
		    <?php
                    }
                    if($labresult[profile_title] && $profile_grp != $labresult[profile_title]){
                    ?>
                        <tr style="background-color:<?php echo $color; ?>">
                                <td  class="tdfont childtdF">&nbsp;</td>	
                                <td  class="tdfont childtd">&nbsp;</td>
                                <td  class="tdfont childtd">&nbsp;</td>
                                <td  class="tdfont childtd" nowrap=nowrap>&nbsp;</td>
                                <td  class="tdfont childtd" nowrap=nowrap>&nbsp;</td>
                                <td class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont subchildtd" colspan="10" nowrap=nowrap>&nbsp;&nbsp;&nbsp;<b><?php echo $this->escapeHtml($labresult[profile_title]); ?></b></td>
                                <!--<td  class="tdfont childtd >&nbsp;</td>
                                <td  class="tdfont childtd">&nbsp;</td>
                                <td  class="tdfont childtd">&nbsp;</td>
                                <td  class="tdfont childtd">&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" align="center">&nbsp;</td>-->
                                <?php  if(($labresult['editor']==1) AND ($labresult['editor']!=0)){ $check=1; ?>
                                <!--<td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>-->
                                <?php }elseif(($labresult['editor']==0) AND ($labresult['editor']!=1)){ ?>
                                <!--<td class="tdfont childtd" style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0">&nbsp;</td>
                                <td class="tdfont childtd" style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0">&nbsp;</td>
                                <td class="tdfont childtd" style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0">&nbsp;</td>-->
                                <?php } elseif((($labresult['editor']==0) OR ($labresult['editor']==1))  AND $check!=1)  { ?>
                                <!--<td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>
                                <td  class="tdfont childtd" >&nbsp;</td>-->
                                <?php } ?>
                                <td style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"   width='10%'>  <?php echo $this->escapeHtml($labresult[order_id]);?> </td>
                        </tr>
                            <?php
                        }
                        if($labresult[result]=='DNR') {
                            $profile_grp = $labresult[profile_title];
                            $main_grp = $labresult[order_title];
														$code_suffix = $labresult[code_suffix];
                            continue;
                        }
                        ?>
                            <tr <?php echo $labresult[result_status] ? '': 'class="context-menu-res"'; ?> id="order-<?php echo $labresult[procedure_order_id]."-".$labresult[procedure_order_seq]."-".$labresult[procedure_name]; ?>" style="background-color:<?php echo $color; ?>">
                                            <td  class="tdfont childtdF">&nbsp;
                                            <?php
                                            if($labresult[order_title]==NULL){
                                            echo $this->escapeHtml($labresult[patient_id]);
                                                if($labresult[patient_id] && $patient_instructions){?>
                                                <a href="#" class="personPopupTrigger" rel="<?php echo $this->escapeHtml($patient_instructions);?>"><img src=<?php echo $this->basePath() ?>/css/icons/comments.png title=<?php echo xlt('Internal Comments'); ?> >
                                                <?php
                                                }
                                            }
                                            else
                                            echo '&nbsp;';
                                            ?>
                                            </td>	
                                            <td  class="tdfont childtd"><?php echo $labresult[order_title]==NULL ? $this->escapeHtml($labresult[date_ordered]) : '&nbsp;';?></td>
                                            <td  class="tdfont childtd"><?php echo $labresult[order_title]==NULL ? $this->escapeHtml($labresult[order_id]) : '&nbsp;';?></td>
                                            <td  class="tdfont childtd" nowrap=nowrap><?php echo $labresult[order_title]==NULL ? $this->escapeHtml($labresult[order_status]) : '&nbsp;';?></td>
                                            <td  class="tdfont childtd" nowrap=nowrap><?php echo $labresult[order_title]==NULL ? $this->escapeHtml($labresult[date_collected]) : '&nbsp;';?></td>
                                            <td class="tdfont childtd" ><?php echo $labresult[order_title]==NULL ? $this->escapeHtml($labresult[report_status]) : '&nbsp;';?></td>
                                            <td  class="tdfont childtd" nowrap=nowrap>
                                                    <?php if($labresult[order_title]==NULL){
                                                    ?>
                                                    <b><?php echo $this->escapeHtml($labresult[result_text]);?></b>
                                                    <?php
                                                    }
                                                    else{?>
                                                     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?php echo $this->escapeHtml($labresult[result_text]);?>
                                                    <?php
                                                    }
                                                    ?>
                         </td>
                            <?php
                            $icclas=$title='';
                            if($labresult[abnormal]=="H" || $labresult[abnormal]=="high"){
                               $icclas='icon-H';
                               $title = xlt('HIGH');
                            }
                            elseif($labresult[abnormal]=="HH"){
                               $icclas='icon-HH';
                               $title = xlt('VERY HIGH');
                            }elseif($labresult[abnormal]=="L" || $labresult[abnormal]=="low"){
                               $icclas='icon-L';
                               $title = xlt('LOW');
                            }
                            elseif($labresult[abnormal]=="LL"){
                               $icclas='icon-LL';
                               $title = xlt('VERY LOW');
                            }
                            elseif($labresult[abnormal]=="N" || $labresult[abnormal]=="no"){
                               $icclas='icon-ok';
                               $title = xlt('NORMAL');
                            }
                            elseif($labresult[abnormal]=="A" || $labresult[abnormal]=="yes"){
                                                                    $icclas='icon-A';
                               $title = xlt('ABNORMAL');
                            }
                            else
                            $icon = $labresult[abnormal];
                                                     $helper = $this->getHelperPluginManager()->getServiceLocator()->get('viewhelpermanager')->get('emr_helper');
                                                     $res_units = $helper->getDropdownValAsText("proc_unit",$labresult[units]);
                            ?>
                         <td  class="tdfont childtd <?php echo $icclas;?>" title="<?php echo $title;?>"><?php echo $icon;?></td>
                         <td  class="tdfont childtd" title="<?php echo $labresult[result];?>"><?php echo $labresult[result];?></td>
                                            <td  class="tdfont childtd" title="<?php echo $this->escapeHtml($labresult[units]);?>"><?php echo $this->escapeHtml($labresult[units]);?></td>
                                            <td  class="tdfont childtd" title="<?php echo $this->escapeHtml($labresult[range]);?>"><?php echo strip_tags($labresult[range]);?> </td>
                         <td  class="tdfont childtd" >
                            <?php
                            $resStat = '';
                            if($labresult[result_status]=='F')
                            $resStat = xlt('Final');
                            elseif($labresult[result_status]=='P')
                            $resStat = xlt('Preliminary');
                            elseif($labresult[result_status]=='I')
                            $resStat = xlt('Pending');
                            elseif($labresult[result_status]=='C')
                            $resStat = xlt('Correction');
                            elseif($labresult[result_status]=='X')
                            $resStat = xlt('Cancelled');
                            else
                            $resStat = ucwords($labresult[result_status]);
                            if(!$resStat){
                              $resStat = "Pending";
                            }
                            echo $resStat;
                            ?>
                         </td>
                         <!--<td  class="tdfont childtd" style="padding-left:13px;" ><a href="#" onclick="editComments(<?php echo $this->escapeHtml($labresult[procedure_report_id]);?>)"><img src=<?php echo $this->basePath() ?>/css/icons/comments.png title=<?php echo xlt('Comments'); ?> ></td>-->
                                            <td  class="tdfont childtd <?php echo trim($labresult[comments]) ? 'comments_col': ''; ?>" align="center" >
                         <?php
                         $comments='';
                                                     if(trim($labresult[comments])){
                         $comments = $labresult[comments];
                         ?>
                                                     <a id="<?php echo $i;?>" name="<?php echo $i;?>"  onclick="showcomments('<?php echo $i;?>')">
                                                                     <img src=<?php echo $this->basePath() ?>/css/icons/comments.png title=<?php echo xlt('Comments'); ?> >
                                                     </a>
                                                     <?php
                                                     }
                                                     ?>
                                            </td>
                                            <?php  if(($labresult['editor']==1) AND ($labresult['editor']!=0)){ $check=1; ?>
                                            <td  class="tdfont childtd" > <a href="#" onclick="getLabelDownload(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img  src=<?php echo $this->basePath() .'/css/icons/label_download.png'; ?> > </td>
                                            <td  class="tdfont childtd" > <a href="#" onclick="getRequisition(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img  src=<?php echo $this->basePath() .'/css/icons/request.png'; ?> > </a></td>
                                            <td  class="tdfont childtd" > <a href="#" onclick="getResult(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img  src=<?php echo $this->basePath() .'/css/icons/pdf_icon.png'; ?> > </a></td>
                                             
                                            
                                            <?php }elseif(($labresult['editor']==0) AND ($labresult['editor']!=1)){ ?>
                                            <!--<td class="tdfont childtd" style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"> &nbsp; </td>
                                            <td class="tdfont childtd" style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"> &nbsp; </a></td>
                                            <td class="tdfont childtd" style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"> &nbsp; </a></td>-->
                                            
                                            <?php } elseif((($labresult['editor']==0) OR ($labresult['editor']==1))  AND $check!=1)  { ?>
                                            
                                            <td  class="tdfont childtd" > <a href="#" onclick="getLabelDownload(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img <?php if($labresult['editor']==0){?> style="display:none;" <?php }?>  src=<?php echo $this->basePath() .'/css/icons/label_download.png'; ?> > </td>
                                            <td  class="tdfont childtd" > <a href="#" onclick="getRequisition(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img <?php if($labresult['editor']==0){?> style="display:none;" <?php }?>   src=<?php echo $this->basePath() .'/css/icons/request.png'; ?> > </a></td>
                                            <td  class="tdfont childtd" > <a href="#" onclick="getResult(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img <?php if($labresult['editor']==0){?> style="display:none;" <?php }?>   src=<?php echo $this->basePath() .'/css/icons/pdf_icon.png'; ?> > </a></td>
                                             
                                            
                                            <?php } ?>
                                            <td style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"   width='10%'>  <?php echo $this->escapeHtml($labresult[order_id]);?> </td>
                            </tr>
                            <?php
                            if(trim($labresult[comments])){
                            ?>
                              <tr id="full_comments_<?php echo $i;?>" >
                                <td colspan="6" class="comments_blank_bg" >
                                </td>
                                <td colspan="7" class="comments_bg comments_td" >
                                  <div class="text-container">
                                    <div class="text-content short-text">
                                        <?php echo "<pre>".str_replace("\\r\\n","<br>",$labresult[comments])."</pre>"; ?>
                                    </div>
                                    <?php if(substr_count($labresult[comments],"\\r\\n") > 7){ ?>
                                    <div class="show-more">
                                        <a href="#">Show more</a>
                                    </div>
                                    <?php } ?>
                                  </div>
                                </td>
                                <td colspan="3" class="comments_blank_bg" >
                                </td>
                              </tr>
                            <?php
                            }
                            ?>
                <?php
                        $i++;
                        $profile_grp = $labresult[profile_title];
                        $main_grp = $labresult[order_title];
												$code_suffix = $labresult[code_suffix];
                        endforeach;
                ?>
	
      </table>
	<!-- Result listing ends  here------------------------------------->
	
	 <?php
	
 	 $totPages = ceil($totrows/20);
	 if(!isset($_GET['pageno'])){
	   $_GET['pageno']=1;
	 }
	 
	 ?>
		        	   
	   <div align="justify" style="float:left;border:1px solid #ddd;padding-left:6px;padding-top:4px;padding-bottom:3px;background-color: #F4F4F4;width:99.1%;">
	   
		<div style="float:left;margin-top: 3px;">
			<a style="margin-top:5px;cursor:hand;cursor:pointer" onclick="movefirstlast(1)"><img  src=<?php echo $this->basePath() .'/css/icons/movfirst.png'; ?> ></a> 
		</div>
		<div style="float:left;margin-top: 3px;">
	     <a style="margin-top:5px;cursor:hand;cursor:pointer"  <?php if($_GET['pageno'] AND ($_GET['pageno']> 1) ) {?> onclick="movenext1(<?php echo $_GET['pageno'] - 1 ?> ) <?php } ?>"><img  src=<?php echo $this->basePath() .'/css/icons/movprev.png'; ?> ></a> 
		</div>
		<div style="float:left;">
	     <label style="margin-left:20px;" for="pageno">Page</label>
	     <select name="pageno" id="pageno" style="width:40px;" onchange="movenext()" >
		<?php 
			
			for($i=1; $i<=$totPages; $i++) {
			$sel = "";
			if($_GET['pageno'] == $i){  $sel = "selected=\"selected\""; }?>
		
		<option value="<?php echo $i ?>" <?php echo $sel; ?>  > <?php echo $i ?> </option>
		<?php } ?>
		
	     </select>
	     <?php echo "of ".$totPages; ?>
		</div>
		<div style="float:left;margin-top: 3px;">
	     <a style="margin-left:20px; margin-top:5px;cursor:hand;cursor:pointer" <?php if($_GET['pageno'] AND ($_GET['pageno']< $totPages) ) {?> onclick="movenext1(<?php echo $_GET['pageno'] +1 ?> ) <?php } ?>"><img  src=<?php echo $this->basePath() .'/css/icons/movenext.png'; ?> ></a> 
		</div>
		<div style="float:left;margin-top: 3px;">
	     <a style="margin-top:5px;cursor:hand;cursor:pointer" onclick="movefirstlast(<?php echo  $totPages ?>)"><img   src=<?php echo $this->basePath() .'/css/icons/movelast.png'; ?> ></a> 
	    </div>
	   </div>
      </div>
	    
	    <div id="dlg" class="easyui-dialog" style="top:150;width:550px;padding:10px 20px"  
            closed="true" buttons="#dlg-buttons">  
            <div class="ftitle" id='titleShow'></div>  
                <div id="commentsF"></div>
                   </div>
	<?php
  }
  echo $this->headScript()->prependFile($this->basePath() . '/js/lib/jquery.ui.position.js')
        ->prependFile($this->basePath() . '/js/lib/jquery.contextMenu.js')
        ->prependFile($this->basePath() . '/js/lib/jquery-1.8.2.min.js')
  ?>