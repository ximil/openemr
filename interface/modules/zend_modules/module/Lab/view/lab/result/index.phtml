         <?php $match = array(
              "/&lt;ref(?:[^\/&]|&(?!gt;))*\/&gt;/is","/&lt;ref[^\/]*&gt;(.*?)&lt;\/ref&gt;/s",);?> 
	     <div class="panel-header" style="width: 98.9%;">
             <div class="panel-title">Lab Result</div>
             <div class="panel-tool"></div>
         </div>
	     <div class="datagrid-wrap panel-body" title="" style="width: 99.8%;">
	      <div id="toolbar">
		   <!-- <a href="#" class="easyui-linkbutton" iconCls="icon-save" plain="true" onclick="javascript:$('#dg').edatagrid('saveRow')"><?php echo xlt('Save'); ?></a>
		    <a href="#" class="easyui-linkbutton" iconCls="icon-undo" plain="true" onclick="javascript:$('#dg').edatagrid('cancelRow')"><?php echo xlt('Cancel'); ?></a>
                   <!-- <span style="text-align: right; padding-left: 750px;">
                    <span class="extlab">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <span style="font-size: 10px;">  Ext Labs</span>
                    <span class="local">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <span style="font-size: 10px;"> <?php echo xlt('Local Labs'); ?></span>
                   </span>-->
		    <form id="frmsearch" method="post" novalidate>		   
		     <div style="text-align: left; padding-left:20px;">
                      <div style="text-align: left;">
                       <span style="text-align: left; font-weight: bold; margin-left: 1px;"><?php echo xlt('Date'); ?></span>
                       <span style="text-align: left; font-weight: bold; margin-left: 250px;"><?php echo xlt('Status'); ?></span>
                        </div>
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('From'); ?>: <input class="easyui-datebox" style="width:80px" name='dtFrom' >
			 </span>
			 <span style="text-align: left; padding-right: 50px;">
			 <?php echo xlt('To'); ?>: <input class="easyui-datebox" style="width:80px" name='dtTo' >
			 </span>
                         
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('Order'); ?>:
			 <input id="searchStatusOrder" class="easyui-combobox" name="searchStatusOrder" 
                                data-options="valueField:'value',textField:'label',
                                url:'./result/getLabOptions?opt=search&optId=order'" />
			 </span>
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('Report'); ?>:
			 <input id="cc" class="easyui-combobox" name="searchStatusReport" 
                                data-options="valueField:'value',textField:'label',
                                url:'./result/getLabOptions?opt=search&optId=report'" />
			 </span>
			 <span style="text-align: left; padding-right: 10px;">
			 <?php echo xlt('Result'); ?>:
			 <input id="searchStatusResult" class="easyui-combobox" name="searchStatusResult" 
                                data-options="valueField:'value',textField:'label',
                                url:'./result/getLabOptions?opt=search&optId=result'" />
			 </span>

			 <a href="#" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="doSearch()">
			 <!-- <input type="submit" value="Search" ></a>-->
                           <?php echo xlt('Search'); ?> </a>
            
		  </div>
		  </form>
	     </div>
	     
	<!-- Lab Result listing starts here------------------------------------->
		
	<table id="labresult"  class="dv-table gridview2 thcolor" cellspacing="0" cellpadding="0" style="width:99%;height:auto;background:#ffffff;padding:5px;margin-top:5px;margin-bottom:15px;">
	       <thead">
                 <tr>
	          <th  colspan="5"><?php echo xlt('Order'); ?></th>     
                  <th  colspan="2"><?php echo xlt('Report'); ?></th>
                  <th  colspan="6"><?php echo xlt('Results and Recommendations'); ?></th>
		   <?php $count=0;$cnt=0;?>
		   <?php $i = 0; foreach ($labresults as $labresult) :
		   
		        if(($labresult['editor']==1) AND ($labresult['editor']!=0) AND $count==0){$check=1; ?> 
                          <th colspan="3"><?php echo xlt('Action'); ?></th>  
		           <?php $count=1; 
		           }
			elseif(($labresult['editor']==0) AND ($labresult['editor']!=1) )  { ?>
			      <th style="display:none;" colspan="3"><?php echo xlt('Action'); ?></th>
		          <?php }
			elseif((($labresult['editor']==0) OR ($labresult['editor']==1)) AND $cnt==0 AND $check!=1)  { ?>
			  <th colspan="3"><?php echo xlt('Action'); ?></th>  
		           <?php $cnt=1; }
		    $i++; endforeach; ?>
		         
                 </tr>
                </thead>
	         <tr bor>
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='3%'><b><?php echo xlt('PID'); ?></b></td>
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='5%'><b><?php echo xlt('Order Date'); ?></b></td>
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" ><b><?php echo xlt('Procedure Name'); ?></b></td>
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='3%'><b><?php echo xlt('Ord.No.'); ?></b></td>
			<!--<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='10%'><b><?php echo xlt('Encounter'); ?></b></td>-->
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0"  width='10%'><b><?php echo xlt('Status'); ?></b></td>
			<!--<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='10%'><b><?php echo xlt('Reported'); ?></b></td>-->
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0"  width="20%" title="<?php echo xlt('Time Collected'); ?>"><b><?php echo xlt('Time Collected'); ?></b></td>
			<!--<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='10%'><b><?php echo xlt('Specimen'); ?></b></td>-->
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='10%'><b><?php echo xlt('Status'); ?></b></td>
			<!--<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='10%'><b><?php echo xlt('Code'); ?></b></td>-->
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" ><b><?php echo xlt('Name'); ?></b></td>
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0"  width='3%'><b><?php echo xlt('Abn'); ?></b></td>
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0"  width='4%'><b><?php echo xlt('Value'); ?></b></td>
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0"  width='5%'><b><?php echo xlt('Units'); ?></b></td>
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0"  width='6%'><b><?php echo xlt('Range'); ?></b></td>
			<td  style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0"  width='4%' title="<?php echo xlt('Comments'); ?>"><b><?php echo xlt('Comm'); ?></b></td>
			<?php $count=0;$cnt=0;?>
			<?php $i = 0; foreach ($labresults as $labresult) : 
			if(($labresult['editor']==1) AND ($labresult['editor']!=0) AND $count==0){$check=1; ?>
			<td style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='4%'><b><?php echo xlt('Label'); ?></b></td>
			<td style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='4%' title="<?php echo xlt('Requisition'); ?>"><b><?php echo xlt('Reqsn'); ?></b></td>
			<td style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='4%'><b><?php echo xlt('Result'); ?></b></td>
			 <?php $count=1; ?>
			
			<?php } elseif(($labresult['editor']==0) AND ($labresult['editor']!=1)) {?>
			<td style="display:none;border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='4%'><b><?php echo xlt('Label'); ?></b></td>
			<td style="display:none;border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='4%' title="<?php echo xlt('Requisition'); ?>"><b><?php echo xlt('Reqsn'); ?></b></td>
			<td style="display:none;border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0"  width='4%'> <?php echo xlt('Result'); ?></b></td>
			<?php } elseif((($labresult['editor']==0) OR ($labresult['editor']==1)) AND $cnt==0 AND $check!=1)  { ?>
			<td style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='4%'><b><?php echo xlt('Label'); ?></b></td>
		        <td style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='4%' title="<?php echo xlt('Requisition'); ?>"><b><?php echo xlt('Reqsn'); ?></b></td>
		        <td style="border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0" width='4%'><b><?php echo xlt('Result'); ?></b></td>
		        <?php  $cnt=1; }
			$i++; endforeach; ?>
			<td  style="display:none;border-style:dotted;border-width:0 0 1px 0;border-color:#c0c0c0"  width='5%'><b><?php echo xlt('order'); ?></b></td>
	     
	        </tr>
	        <?php $i = 0; foreach ($labresults as $labresult) : 
			$color = ($labresult['color'] <> "") ? $labresult['color'] : $color;
			$totrows = $labresult['totalRows'];
			?>
                <tr style="background-color:<?php echo $color; ?>">
			 <td style="border-style:dotted;border-width:0 1px 1px 1px;border-color:#c0c0c0" class="tdfont"><?php echo $this->escapeHtml($labresult[patient_id]);?></td>	
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont"><?php echo $this->escapeHtml($labresult[date_ordered]);?></td>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" title=" <?php echo $this->escapeHtml($labresult[procedure_name]);?>" nowrap=nowrap> 
						 <?php echo $this->escapeHtml($labresult[procedure_name]);?></td>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont"><?php echo $this->escapeHtml($labresult[order_id]);?></td>
			 <!-- <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont"><?php echo $this->escapeHtml($labresult[encounter_id]);?></td>-->
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont"><?php echo $this->escapeHtml($labresult[order_status]);?></td>
                         <!--<td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont"> <?php echo $this->escapeHtml($labresult[date_report]);?></td>-->
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" title="<?php echo $this->escapeHtml($labresult[date_collected]);?>">
                            <?php echo $this->escapeHtml(substr($labresult[date_collected],0,10));?>
                         </td>
                         <!--<td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"class="tdfont"><?php echo $this->escapeHtml($labresult[specimen_num]);?></td>-->
		         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"class="tdfont" ><?php echo $this->escapeHtml($labresult[report_status]);?></td>
                         <!--<td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont"><?php echo $this->escapeHtml($labresult[result_code]);?></td>-->
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" title="<?php echo $this->escapeHtml($labresult[result_text]);?>" nowrap=nowrap>
			    <?php echo $this->escapeHtml($labresult[result_text]);?>
                         </td>
                            <?php
                            $icclas=$title='';
                            if($labresult[abnormal]=="H" || $labresult[abnormal]=="high"){
                               $icclas='icon-H';
                               $title = xlt('HIGH');
                            }
                            elseif($labresult[abnormal]=="HH"){
                               $icclas='icon-HH';
                               $title = xlt('VERY HIGH');
                            }elseif($labresult[abnormal]=="L" || $labresult[abnormal]=="low"){
                               $icclas='icon-L';
                               $title = xlt('LOW');
                            }
                            elseif($labresult[abnormal]=="LL"){
                               $icclas='icon-LL';
                               $title = xlt('VERY LOW');
                            }
                            elseif($labresult[abnormal]=="N" || $labresult[abnormal]=="no"){
                               $icclas='icon-ok';
                               $title = xlt('NORMAL');
                            }
                            elseif($labresult[abnormal]=="A" || $labresult[abnormal]=="yes"){
                               $icclas='icon-cancel';
                               $title = xlt('ABNORMAL');
                            }
                            else
                            $icon = $labresult[abnormal];
                            ?>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont <?php echo $icclas;?>" title="<?php echo $title;?>"><?php echo $icon;?></td>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" title="<?php echo $this->escapeHtml($labresult[result]);?>"><?php echo $this->escapeHtml($labresult[result]);?></td>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" title="<?php echo $this->escapeHtml($labresult[units]);?>"><?php echo $this->escapeHtml(substr($labresult[units],0,5));?></td>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" title="<?php echo $this->escapeHtml($labresult[range]);?>"><?php echo strip_tags(substr($labresult[range],0,9));?> </td>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" style="padding-left:13px;" ><a href="#" onclick="editComments(<?php echo $this->escapeHtml($labresult[procedure_report_id]);?>)"><img src=<?php echo $this->basePath() ?>/css/icons/pencil.png title=<?php echo xlt('Comments'); ?> ></td>

		       <?php  if(($labresult['editor']==1) AND ($labresult['editor']!=0)){ $check=1; ?>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" style="padding-left:5px; "> <a href="#" onclick="getLabelDownload(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img  src=<?php echo $this->basePath() .'/css/icons/label_download.png'; ?> > </td>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" style="padding-left:12px;"> <a href="#" onclick="getRequisition(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img  src=<?php echo $this->basePath() .'/css/icons/request.png'; ?> > </a></td>
                         <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" style="padding-left:5px; "> <a href="#" onclick="getResult(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img  src=<?php echo $this->basePath() .'/css/icons/pdf_icon.png'; ?> > </a></td>
                          
		         
			<?php }elseif(($labresult['editor']==0) AND ($labresult['editor']!=1)){ ?>
		          <td class="tdfont" style="padding-left:5px; display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"> <a href="#" onclick="getLabelDownload(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img  src=<?php echo $this->basePath() .'/css/icons/label_download.png'; ?> > </td>
                          <td class="tdfont" style="padding-left:12px; display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"> <a href="#" onclick="getRequisition(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img  src=<?php echo $this->basePath() .'/css/icons/request.png'; ?> > </a></td>
                          <td class="tdfont" style="padding-left:5px; display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"> <a href="#" onclick="getResult(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img  src=<?php echo $this->basePath() .'/css/icons/pdf_icon.png'; ?> > </a></td>
		         
			 <?php } elseif((($labresult['editor']==0) OR ($labresult['editor']==1))  AND $check!=1)  { ?>
			 
			  <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" style="padding-left:5px; "> <a href="#" onclick="getLabelDownload(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img <?php if($labresult['editor']==0){?> style="display:none;" <?php }?>  src=<?php echo $this->basePath() .'/css/icons/label_download.png'; ?> > </td>
                          <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" style="padding-left:12px;"> <a href="#" onclick="getRequisition(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img <?php if($labresult['editor']==0){?> style="display:none;" <?php }?>   src=<?php echo $this->basePath() .'/css/icons/request.png'; ?> > </a></td>
                          <td style="border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0" class="tdfont" style="padding-left:5px; "> <a href="#" onclick="getResult(<?php echo $this->escapeHtml($labresult[order_id1]);?>)"> <img <?php if($labresult['editor']==0){?> style="display:none;" <?php }?>   src=<?php echo $this->basePath() .'/css/icons/pdf_icon.png'; ?> > </a></td>
                          
			 
		      <?php } ?>
		      <td style="display:none;border-style:dotted;border-width:0 1px 1px 0;border-color:#c0c0c0"   width='10%'>  <?php echo $this->escapeHtml($labresult[order_id]);?> </td>
            </tr>  
              <?php $i++; endforeach; ?>
	
      </table>
	<!-- Result listing ends  here------------------------------------->
	
	 <?php
	
 	 $totPages = ceil($totrows/20);
	 if(!isset($_GET['pageno'])){
	   $_GET['pageno']=1;
	 }
	 
	 ?>
		        	   
	   <div align="justify" style="float:left;border:1px solid #ddd;padding-left:6px;padding-top:4px;padding-bottom:3px;background-color: #F4F4F4;width:99.1%;">
	   
		<div style="float:left;margin-top: 3px;">
			<a style="margin-top:5px;cursor:hand;cursor:pointer" onclick="movefirstlast(1)"><img  src=<?php echo $this->basePath() .'/css/icons/movfirst.png'; ?> ></a> 
		</div>
		<div style="float:left;margin-top: 3px;">
	     <a style="margin-top:5px;cursor:hand;cursor:pointer"  <?php if($_GET['pageno'] AND ($_GET['pageno']> 1) ) {?> onclick="movenext1(<?php echo $_GET['pageno'] - 1 ?> ) <?php } ?>"><img  src=<?php echo $this->basePath() .'/css/icons/movprev.png'; ?> ></a> 
		</div>
		<div style="float:left;">
	     <label style="margin-left:20px;" for="pageno">Page</label>
	     <select name="pageno" id="pageno" style="width:40px;" onchange="movenext()" >
		<?php 
			
			for($i=1; $i<=$totPages; $i++) {
			$sel = "";
			if($_GET['pageno'] == $i){  $sel = "selected=\"selected\""; }?>
		
		<option value="<?php echo $i ?>" <?php echo $sel; ?>  > <?php echo $i ?> </option>
		<?php } ?>
		
	     </select>
	     <?php echo "of ".$totPages; ?>
		</div>
		<div style="float:left;margin-top: 3px;">
	     <a style="margin-left:20px; margin-top:5px;cursor:hand;cursor:pointer" <?php if($_GET['pageno'] AND ($_GET['pageno']< $totPages) ) {?> onclick="movenext1(<?php echo $_GET['pageno'] +1 ?> ) <?php } ?>"><img  src=<?php echo $this->basePath() .'/css/icons/movenext.png'; ?> ></a> 
		</div>
		<div style="float:left;margin-top: 3px;">
	     <a style="margin-top:5px;cursor:hand;cursor:pointer" onclick="movefirstlast(<?php echo  $totPages ?>)"><img   src=<?php echo $this->basePath() .'/css/icons/movelast.png'; ?> ></a> 
	    </div>
	   </div>
      </div>
	    
	    <div id="dlg" class="easyui-dialog" style="width:500px;height:380px;padding:10px 20px"  
            closed="true" buttons="#dlg-buttons">  
            <div class="ftitle" id='titleShow'></div>  
             <form id="fm" method="post" novalidate>
		       <input type='hidden' name='rep_id' id='rep_id' value='' />
               <div class="fitem">  
                <label><?php echo xlt('Status'); ?>:</label>  
			      <input id="cc1" class="easyui-combobox" name="formResultStatus" 
                                data-options="valueField:'value',textField:'label',
                                url:'./result/getLabOptions?opt=status&optId=result'" />
                   </div>  
                  <div class="fitem">  
                   <label><?php echo xlt('Facility'); ?>:</label>  
                   <input name="formResultFacility" class="easyui-validatebox" style="width: 280px"; >  
                  </div>  
                  <div class="fitem">  
                  <label><?php echo xlt('Comments'); ?>:</label>  
		          <textarea id='formResultComments' name="formResultComments" style="height:60px; width: 280px;"></textarea>  
                  </div>  
                  <div class="fitem">  
                  <label><?php echo xlt('Notes'); ?>:</label>  
		          <textarea id='formResultNotes' name="formResultNotes" style="height:60px; width: 280px;"></textarea>
                 </div>  
             </form>  
        </div>  
        <div id="dlg-buttons">  
          <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" onclick="saveComments()">
            <?php echo xlt('Save'); ?>
          </a>  
        </div> 
      
   
  
	