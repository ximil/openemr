<style>
table.gridview2 td{
		border-style: dotted;
		border-width: 1px 1px 1px 1px;
		margin: 0;padding: 0;
		border-color:#cccccc;
}
table.thcolor th{
		background:linear-gradient(to bottom, #EFF5FF 0px, #E0ECFF 100%) repeat-x scroll 0 0 transparent;
		border: 1px solid #cccccc;
		height:10px;
		height:20px; 
}
#patdiv{
		position: absolute;
		left: 422px;
		border: 1px solid;
		display: none;
		min-width: 143px;
		background-color: #fff;
}
.hid_div{
		position: absolute;
		left: 360px;
		top: 220px;
		background-color: #ddd;
		border-width: 1px;
		padding: 5px;
		border-style: solid;
}
</style>
<script type="text/javascript">
$(document).ready(function (){
		<?php if($this->layout()->saved == 'yes'){ ?>
		alert('Successfully Saved');
		<?php } ?>
		$('.hid_div').click(function(e) { //button click class name is myDiv
			e.stopPropagation();
		})
		$(document).click(function(){  
			$('.hid_div').hide();
		});
});
function doSearch(){
		if($("#search_patient").val() == ''){
				$("#patient_id").val('');
		}
		$("#resultentry").submit();
}
function doSave(){
		$("#resultentry").attr("action", window.location.href.replace("resultEntry","saveResultEntry"));
		$("#resultentry").submit();
}
function showMore(val){
		$("#hid_div_"+val).css('display','block');
}
</script>
<div style="margin:10px 0;"></div>
<div class="easyui-panel" title="<?php echo xlt('Result Entry');?>" >
	<div style="padding:10px;">
		<?php
		$form = $this->form;
		$form->setAttribute('action', $this->url('result', array('action' => 'resultEntry')));
		$form->prepare();
		
		echo $this->form()->openTag($form);
		?>
		<div>
				<div>
						<span class="bold mediumfont" >Date</span>
				</div>
				<div style="float:left;padding-right:10px;">
						<span><?php echo xlt('From').":&nbsp;"; echo $this->formRow($form->get('search_from_date')); ?></span>
						<span><?php echo xlt('To').":&nbsp;"; echo $this->formRow($form->get('search_to_date')); ?></span>
						<span style="padding-left:25px;"><?php echo xlt('Patient').":&nbsp;"; echo $this->formRow($form->get('search_patient')); ?></span>
						<div id="patdiv" ></div>
						<?php echo $this->formRow($form->get('patient_id')); ?>
				</div>
				<a href="#" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="doSearch()"><?php echo xlt('Search'); ?></a>
		</div>
		<br/>
		<a href="#" class="easyui-linkbutton" iconCls="icon-save" plain="true" onclick="doSave()"><?php echo xlt('Save'); ?></a>
		<table id="specimentable" class="dv-table gridview2 thcolor" style="width:99%;height:auto;background:#ffffff;padding:5px;margin-top:5px;margin-bottom:15px;" >
			<tr>
					<th colspan="2" class="mainhead" >Order</th>
					<th colspan="3" class="mainhead" >Report</th>
					<th colspan="7" class="mainhead" >Results and Recommendations</th>
			</tr>
			<tr>
					<td style="width:80px;" >Date</td>
					<td style="min-width:200px;" >Name</td>
					<td >Specimen</td>
					<td >Specimen Time Collected</td>
					<td >Specimen Status</td>
					<td >Group</td>
					<td >Name</td>
					<td >Abn</td>
					<td >Value</td>
					<td >Units</td>
					<td >Range</td>
					<td >More</td>
			</tr>
			<?php foreach($this->layout()->res as $val):
			$helper = $this->getHelperPluginManager()->getServiceLocator()->get('viewhelpermanager')->get('emr_helper');
			$rep_status = $helper->getDropdownValAsText("proc_rep_status",$val['report_status']);
			?>
			<tr>
				<?php echo $this->formRow($form->get('procedure_report_id[]')->setValue($val['prid'])); ?>
				<td><?php echo $val['date_ordered']; ?></td>
				<td><?php echo $val['procedure_name']; ?></td>
				<td><?php echo $val['specimen_num']; ?></td>
				<td><?php echo $val['date_collected']; ?></td>
				<td><?php echo $rep_status; ?></td>
				<td><?php echo ""; ?></td>
				<td><?php echo $val['result_text']; ?></td>
				<td><?php echo $this->formRow($form->get('abnormal[]')->setValue($val['abnormal'])); ?></td>
				<td><?php echo $this->formRow($form->get('result[]')->setValue($val['result'])); ?></td>
				<td><?php echo $this->formRow($form->get('units[]')->setValue($val['units'])); ?></td>
				<td><?php echo $this->formRow($form->get('range[]')->setValue($val['range'])); ?></td>
				<td><a href="javascript:showMore('<?php echo $val['prid']; ?>')" >More</a></td>
			</tr>
			<tr>
				<td>
						<div id="hid_div_<?php echo $val['prid']; ?>" class="hid_div gridview2" style="display:none;" >
							<table>
								<tr>
									<td>Status</td>
									<td><?php echo $this->formRow($form->get('result_status[]')->setValue($val['result_status'])); ?></td>
								</tr>
								<tr>
									<td>Facility</td>
									<td><?php echo $this->formRow($form->get('facility[]')->setValue($val['facility'])); ?></td>
								</tr>
								<tr>
									<td>Comments</td>
									<td><?php echo $this->formRow($form->get('comments[]')->setValue($val['comments'])); ?></td>
								</tr>
								<tr>
									<td>Notes</td>
									<td><?php echo $this->formRow($form->get('notes[]')->setValue($val['notes'])); ?></td>
								</tr>
							</table>
						</div>
				</td>
			</tr>
			<?php endforeach; ?>
		</table>
  </div>
</div>
<?php
echo $this->form()->closeTag();
echo $this->headScript()->prependFile($this->basePath() . '/js/lib/jquery-1.8.2.min.js')
			->prependFile($this->basePath() . '/js/lab/patient.js')
			->prependFile($this->basePath() . '/js/lib/jquery.autocomplete.js')
			->prependFile($this->basePath() . '/js/lib/jQuery.bubbletip-1.0.6.js')
			->prependFile($this->basePath() . '/js/lib/bubbles.js')
?>